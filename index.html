
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>RPG de Tarefas</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADMklEQVR42u3dv20CMRTAYRO5uAEYgC3SRlDCABkvA6TMdYmUEoZgj+ugTYUOgfyce9/X5887mZ/sKDqvNmV7KYGGYYj88WWapmJ+82ed/6UAaQkACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACABwr+p+dvObP+/8dgDgCAAIACAAgAAAAgAIALA41SN4zMfn6CF05P2w8xDsAAABAAQAEABAAAABAAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEAelLdzz5ZBQty73rKvv7tAMARABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAYLYafT959vvZiV1P2de/HQA4AgACAAgAIACAAAACACxO9Qj69rov4zO/32kse08VOwBAAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAgO6lfx/A1++Yat71etnzfR9/Hvr6w1uu1yXYAYAjACAAgL8B0I/zyTv8sAMABAAQAOA5fwOIvp88+n52+Kv15yF6/dsBgCMAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIADAbDX6fvLW97HDLa0/D9Hr3w4AHAEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQBmq9H3k7e+jx1uaf15iF7/dgDgCAAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIABBqtSnbS+QvEP1OtOzvRDR/7vntAMARABAAQAAAAQAEABAAQAAAAQAEABAA4F+q/hfb/ObPO78dADgCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAzHYFwHlgSTjklsQAAAAASUVORK5CYII=" />
<style>
:root{--bg-dark1:#0f0424;--bg-dark2:#2b0a44;--accent:#C084FC}
html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg-dark1),var(--bg-dark2));color:#eef2ff}
.app{max-width:720px;margin:0 auto;height:100vh;display:flex;flex-direction:column;padding:12px;gap:10px}
.header{display:flex;justify-content:space-between;align-items:center}
.title{font-weight:900;font-size:18px}
.menu-card{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px}
.avatar-rect{width:220px;height:132px;border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;border:3px solid rgba(192,148,255,0.16);background:linear-gradient(180deg,rgba(76,29,149,0.55),rgba(31,6,74,0.55))}
.avatar-rect img{image-rendering:pixelated;width:128px;height:128px}
.xp-bar{width:100%;height:18px;background:#3b2b49;border-radius:8px;overflow:hidden}
.xp-fill{height:100%;width:0%;background:linear-gradient(90deg,#7be3ff,#c084fc);transition:width .6s}
.menu-grid{display:flex;gap:12px}
.footer{font-size:12px;color:#ccc;text-align:center;margin-top:8px}
@media (max-width:720px){.menu-grid{flex-direction:column}.avatar-rect{width:280px;height:160px}}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="title">RPG de Tarefas</div>
    <div class="icon-btn" id="settingsBtn">☰</div>
  </div>

  <div class="menu-card" id="startMenu">
    <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
      <h2>Bem-vindo</h2>
      <div style="display:flex;gap:8px">
        <button id="maleBtn">Masculino</button>
        <button id="femaleBtn">Feminino</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="modeToggle">Modo: Escuro</button>
        <button id="musicSel">Música: Intermediária</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="startBtn" style="background:var(--accent);color:#111">Iniciar</button>
      </div>
      <div style="font-size:12px;color:#ccc;margin-top:8px">Áudio será ativado após clicar em Iniciar</div>
    </div>
  </div>

  <div id="gameUI" style="display:none">
    <div class="menu-grid">
      <div style="width:140px;display:flex;flex-direction:column;gap:8px;align-items:center">
        <div class="slot" id="slotWeapon" style="width:96px;height:96px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">
          <img id="slotWeaponImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADQklEQVR42u3dMU7DMBSAYbfyEHES1C6IDlwBxMIZegUkJFYWJlauwcQh2Fgq9SjZysoUpRDlWXnfdwCKg/PLBmSvNuvbUwnUdV3kx5e+74vxG3/W8a8LkJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAA56ruZzd+4887fisAsAUABAAQAEAAAAEABABYnOoR/M/7y4eH0JD9052HYAUACAAgAIAAAAIACAAgACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIANCS6n723ixYkHPnU/b5bwUAtgCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACj1ej7ybPfz07sfMo+/60AwBYAEABAAAABAAQAEABgcapH0Labx/I55df7eiv3nipWAIAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAzVtdXzycIr+B6HPRD4ertn9Cl6+TngdQjs/OAxiw2x1TzX8rALAFAAQASMWZgK2zZ8cKABAAQACAiX4HEP13yOj72eG3ud+H6PlvBQC2AIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAKPV6PvJ576PHYbM/T5Ez38rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAGK1G308+933sMGTu9yF6/lsBgC0AIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIABAqJr9AWy336GfH30mXPYzIaPHbwUACAAgAIAAAAIACAAgAIAAAAIACAAgAMAfVP+LbvzGn3f8VgBgCwAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIADDaD8czZL0Q9VuCAAAAAElFTkSuQmCC" width="64" height="64"/>
        </div>
        <div class="slot" id="slotArmor" style="width:96px;height:96px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">
          <img id="slotArmorImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADQklEQVR42u3dMU7DMBSAYbfyEHES1C6IDlwBxMIZegUkJFYWJlauwcQh2Fgq9SjZysoUpRDlWXnfdwCKg/PLBmSvNuvbUwnUdV3kx5e+74vxG3/W8a8LkJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAA56ruZzd+4887fisAsAUABAAQAEAAAAEABABYnOoR/M/7y4eH0JD9052HYAUACAAgAIAAAAIACAAgACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIANCS6n723ixYkHPnU/b5bwUAtgCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACj1ej7ybPfz07sfMo+/60AwBYAEABAAAABAAQAEABgcapH0Labx/I55df7eiv3nipWAIAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAzVtdXzycIr+B6HPRD4ertn9Cl6+TngdQjs/OAxiw2x1TzX8rALAFAAQASMWZgK2zZ8cKABAAQACAiX4HEP13yOj72eG3ud+H6PlvBQC2AIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAKPV6PvJ576PHYbM/T5Ez38rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAGK1G308+933sMGTu9yF6/lsBgC0AIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIABAqJr9AWy336GfH30mXPYzIaPHbwUACAAgAIAAAAIACAAgAIAAAAIACAAgAMAfVP+LbvzGn3f8VgBgCwAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIADDaD8czZL0Q9VuCAAAAAElFTkSuQmCC" width="64" height="64"/>
        </div>
        <div class="slot" id="slotCos" style="width:96px;height:96px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">
          <img id="slotCosImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADQklEQVR42u3dMU7DMBSAYbfyEHES1C6IDlwBxMIZegUkJFYWJlauwcQh2Fgq9SjZysoUpRDlWXnfdwCKg/PLBmSvNuvbUwnUdV3kx5e+74vxG3/W8a8LkJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAA56ruZzd+4887fisAsAUABAAQAEAAAAEABABYnOoR/M/7y4eH0JD9052HYAUACAAgAIAAAAIACAAgACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIANCS6n723ixYkHPnU/b5bwUAtgCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACj1ej7ybPfz07sfMo+/60AwBYAEABAAAABAAQAEABgcapH0Labx/I55df7eiv3nipWAIAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAzVtdXzycIr+B6HPRD4ertn9Cl6+TngdQjs/OAxiw2x1TzX8rALAFAAQASMWZgK2zZ8cKABAAQACAiX4HEP13yOj72eG3ud+H6PlvBQC2AIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAKPV6PvJ576PHYbM/T5Ez38rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAGK1G308+933sMGTu9yF6/lsBgC0AIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIABAqJr9AWy336GfH30mXPYzIaPHbwUACAAgAIAAAAIACAAgAIAAAAIACAAgAMAfVP+LbvzGn3f8VgBgCwAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIADDaD8czZL0Q9VuCAAAAAElFTkSuQmCC" width="64" height="64"/>
        </div>
      </div>

      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:8px">
        <div class="avatar-rect" id="avatarRect">
          <img id="avatarImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADRklEQVR42u3dIVLDQBSA4S2zw/QOlVyiqhwAi4MTIFH0BDhwyCpQaAQ34ADYql4igykW1UknaV7I+z7fks1s/tntMNnZoqz2JdD8fB7550vz0xTjN/6s4z8rQFoCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAHKs6n934jT/v+K0AwBYAEABAAAABAAQAEABgcqpb0M3r5tNNGJHr20s3wQoAEABAAAABAAQAEABAAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAGBMqvPZG7NgQo6dT9nnvxUA2AIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgC0VqPPJ89+Pjux8yn7/LcCAFsAQAAAAQAEABAAQACAyaluwbgtb8pHn9/39Vau3FWsAAABAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEARi/9+wAe7186fX73vT3p9S3LRa/fd+rrjfb8sOn0+fXTnRUAIACAAAB+AyDE+3rrHX5YAQACAAgA0MtvANHnk0efzw5/Df08RM9/KwCwBQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAGitRp9PPvR57HDI0M9D9Py3AgBbAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAgNZq9PnkQ5/HDocM/TxEz38rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQACDVblNU+8gKi34mW/Z2Ixp97/FYAYAsACAAgAIAAAAIACAAgAIAAAAIACADwL1X/i238xp93/FYAYAsACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACADQ2i8dO2VPUhVUPAAAAABJRU5ErkJggg==" width="128" height="128" />
        </div>
        <div style="width:100%;max-width:480px">
          <div style="font-weight:800">Nível <span id="levelLabel">1</span> — XP: <span id="xpLabel">0</span>/<span id="xpNext">100</span></div>
          <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
        </div>
      </div>

      <div style="width:260px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:900">Tarefas</div>
          <div class="small">Agendadas: <span id="scheduledCount">0</span></div>
        </div>
        <div class="menu-card" style="margin-top:8px">
          <div style="display:flex;gap:8px;align-items:center">
            <input id="newTitle" placeholder="Nova tarefa..." style="flex:1;padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:#fff"/>
            <select id="newType"><option value="diaria">Diária</option><option value="semanal">Semanal</option><option value="mensal">Mensal</option></select>
            <select id="newImportance"><option value="1">Sem muita importância</option><option value="2">Importante</option><option value="3">Muito importante</option><option value="4">Essencial</option></select>
            <input id="newXP" placeholder="XP" style="width:70px"/>
            <button id="addTask">Adicionar</button>
          </div>
          <div id="taskList" style="margin-top:8px;display:flex;flex-direction:column;gap:8px"></div>
        </div>
      </div>
    </div>

    <div class="menu-card" style="margin-top:10px">
      <div style="font-weight:900">Batalha</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button id="simulateWin" style="background:#10b981;color:#fff">Simular vitória</button>
        <button id="simulateLoss" style="background:#ef4444;color:#fff">Simular falha</button>
      </div>
    </div>

    <div class="footer">RPG de Tarefas • Pixel Glow</div>
  </div>
</div>

<script>
const STORAGE_KEY='rpg-de-tarefas-final-v2';
let state = { character:{gender:'male',level:1,xp:0,totalXP:0,equipped:{weapon:{id:'stick',name:'Graveto',rarity:1},armor:null,cos:null}}, tasks:[], scheduled:[], settings:{mode:'dark',music:'mid',volume:0.6}, monthlyRewardedFor:'' };

try{ const s=localStorage.getItem(STORAGE_KEY); if(s) state=JSON.parse(s); }catch(e){}

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function xpToNext(l){ return Math.floor(100*Math.pow(1.35,l-1)); }
function renderCharacter(){ document.getElementById('levelLabel').textContent=state.character.level; document.getElementById('xpLabel').textContent=state.character.xp; document.getElementById('xpNext').textContent=xpToNext(state.character.level); const pct=Math.max(4,Math.min(100,Math.round((state.character.xp/xpToNext(state.character.level))*100))); document.getElementById('xpFill').style.width=pct+'%'; updateAvatar(); renderTasks(); }
function updateAvatar(){ const img=document.getElementById('avatarImg'); const g=state.character.gender; const m=state.settings.mode==='light'?'light':'dark'; if(g==='male'){ img.src = (m==='dark'? 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADRklEQVR42u3dIVLDQBSA4S2zw/QOlVyiqhwAi4MTIFH0BDhwyCpQaAQ34ADYql4igykW1UknaV7I+z7fks1s/tntMNnZoqz2JdD8fB7550vz0xTjN/6s4z8rQFoCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAHKs6n934jT/v+K0AwBYAEABAAAABAAQAEABgcqpb0M3r5tNNGJHr20s3wQoAEABAAAABAAQAEABAAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAGBMqvPZG7NgQo6dT9nnvxUA2AIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgC0VqPPJ89+Pjux8yn7/LcCAFsAQAAAAQAEABAAQACAyaluwbgtb8pHn9/39Vau3FWsAAABAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEARi/9+wAe7186fX73vT3p9S3LRa/fd+rrjfb8sOn0+fXTnRUAIACAAAB+AyDE+3rrHX5YAQACAAgA0MtvANHnk0efzw5/Df08RM9/KwCwBQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAGitRp9PPvR57HDI0M9D9Py3AgBbAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAgNZq9PnkQ5/HDocM/TxEz38rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQACDVblNU+8gKi34mW/Z2Ixp97/FYAYAsACAAgAIAAAAIACAAgAIAAAAIACADwL1X/i238xp93/FYAYAsACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACADQ2i8dO2VPUhVUPAAAAABJRU5ErkJggg==' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADT0lEQVR42u3dsU3EMBiAUR/nSGnQlRSUrMAWJwZhIoagvg1Y4yoaEA2IgkgRCl0KkFAOovxW/N4AHDbOJxtQvHl6/BhSoLZtIz8+dV2XjN/4ax3/WQKqJQAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAMCpsvvZjd/46x2/HQA4AgACAAgAIACAAAACAKxONgX/83B/NAkFub65NAl2AIAAAAIACAAgAIAAAAIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAJcnuZ++sghU5dT3Vvv7tAMARABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAYLIcfT957fezE7ueal//dgDgCAAIACAAgAAAAgAIALA62RSUbX97dZjz6x3ujnuzih0AIAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAEDxNq8vwxD5DUS/F/3ifFv2T2jXzPo+gPTWex/Ar9PTVLX+7QDAEQAQAKAq3glY/qHUmR07AEAAAAEAZvkdQPTfIaPvZ0+ptwoYLf08RK9/OwBwBAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAJgsR99PvvR97N/tmq1VwGjp5yF6/dsBgCMAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIADAZDn6fvKl72P/qbcKGC39PESvfzsAcAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAIlWufgOf3z9DPj34nXO3vhIwevx0AIACAAAACAAgAIACAAAACAAgAIACAAAB/kP0vuvEbf73jtwMARwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIDJvgBkzG205Q6fBgAAAABJRU5ErkJggg=='); } else { img.src = (m==='dark'? 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADQUlEQVR42u3dMU7DMBSAYRdZqFdAZWMopygjA5dg6qGYysYFGDqyMbMh0blXiFjK2qlKlTQv5H3f3hJHzi+7QvFsUVaHEmh+PY/886X5bYrxG3/W8V8VIC0BAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEAzlWdz278xp93/FYAYAsACAAgAIAAAAIACAAwOdUt6Obna+smjMjt/YObYAUACAAgAIAAAAIACAAgACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIADAm1fnsjVkwIefOp+zz3woAbAEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQBaq9Hnk2c/n53Y+ZR9/lsBgC0AIACAAAACAAgAIADA5FS3YOSW5b3X7/suT24qVgCAAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAKOX/n0A25dNp8/vPvcXvb675U2v33fp6432sXnr9PnH9bMVACAAgAAAfgMgxO517x1+WAEAAgAIANDLbwDR55NHn88Ox4Z+HqLnvxUA2AIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgC0VqPPJx/6PHY4ZejnIXr+WwGALQAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAEBrNfp88qHPY4dThn4eoue/FQDYAgACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAISaLcrqEHkB0e9Ey/5OROPPPX4rALAFAAQAEABAAAABAAQAEABAAAABAAQA+Jeq/8U2fuPPO34rALAFAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAaO0PM01lD+0VGRQAAAAASUVORK5CYII=' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADQUlEQVR42u3dMU7DMBSAYQOWyGZ1QjkT5+UkHIEhVGLJUlJFCNaKAaUkykvj79tpecH95VQovnt/+/xOgZqmiXz7NAxDMr/5a53/PgHVEgAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAOBa2fns5jd/vfPbAYBbAEAAAAEABAAQAEAAgN3JLsE8Zezn/fxD8ADjOfb6LTz/8evRorQDAAQAEABAAAABAAQAEAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABADYkux89nnzhz/Xn1nrqfb1bwcAbgEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAmy9Hnk9/8+ezj2SrakGvXU+3r3w4A3AIAAgAIACAAgAAAAgDsTnYJNq4tL4u+Xtc/u6jYAQACAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAbF71zwMoXbftX7Aty77ex2nXf8+nNG++vm3tAAABAAQA8B0AMV47z/DDDgAQAEAAgEW+A4g+nzz6fHa4tPbnIXr92wGAWwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIDJcvT55Gufx/5bsQa4sPbnIXr92wGAWwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIDJcvT55Gufxw5/WfvzEL3+7QDALQAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAECoXPsFOB4Ooe8f/Uy42p8JGT2/HQAgAIAAAAIACAAgAIAAAAIACAAgAIAAAP+Q/S+6+c1f7/x2AOAWABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAYLIftM1lLYk2FUcAAAAASUVORK5CYII='); } }

document.getElementById('addTask').addEventListener('click', ()=>{ const title=document.getElementById('newTitle').value.trim(); if(!title) return alert('Nome da tarefa?'); const type=document.getElementById('newType').value; const imp=Number(document.getElementById('newImportance').value); const xp=Number(document.getElementById('newXP').value)||20; const obj={id:'t-'+Math.random().toString(36).slice(2,9),title,type,importance:imp,xp,created:Date.now(),due:(type==='diaria'?Date.now()+24*3600*1000: type==='semanal'?Date.now()+7*24*3600*1000:Date.now()+30*24*3600*1000),done:false}; state.tasks.unshift(obj); save(); renderCharacter(); document.getElementById('newTitle').value=''; });

function renderTasks(){ const list=document.getElementById('taskList'); list.innerHTML=''; state.tasks.forEach(t=>{ const el=document.createElement('div'); el.style.display='flex'; el.style.justifyContent='space-between'; el.style.alignItems='center'; el.style.background='rgba(255,255,255,0.02)'; el.style.padding='6px'; el.style.borderRadius='8px'; el.innerHTML=`<div><div style="font-weight:800">${t.title}</div><div style="font-size:12px;color:#ccc">${t.type} • ${t.xp} XP • ${['','Sem muita importância','Importante','Muito importante','Essencial'][t.importance]}</div></div>`; const right=document.createElement('div'); const btn=document.createElement('button'); btn.textContent='Concluir'; btn.onclick=()=>completeTask(t.id); const del=document.createElement('button'); del.textContent='Excluir'; del.onclick=()=>{ state.tasks=state.tasks.filter(x=>x.id!==t.id); save(); renderCharacter(); }; right.appendChild(btn); right.appendChild(del); el.appendChild(right); list.appendChild(el); }); }

function completeTask(id){ const task=state.tasks.find(t=>t.id===id); if(!task) return; const bonus = 1 + (0.025*(task.importance-1)); const gained = Math.round(task.xp * bonus); state.character.xp += gained; state.character.totalXP += gained; while(state.character.xp >= xpToNext(state.character.level)){ state.character.xp -= xpToNext(state.character.level); state.character.level++; } task.done=true; task.completedAt=Date.now(); save(); renderCharacter(); const chest=document.createElement('div'); chest.style.position='fixed'; chest.style.left='50%'; chest.style.top='50%'; chest.style.transform='translate(-50%,-50%)'; chest.style.width='160px'; chest.style.height='100px'; chest.style.background='linear-gradient(180deg,#c08aff,#ffd166)'; chest.style.display='flex'; chest.style.alignItems='center'; chest.style.justifyContent='center'; chest.style.borderRadius='10px'; chest.style.zIndex=9999; chest.textContent='BAÚ'; document.body.appendChild(chest); setTimeout(()=>{ chest.remove(); },1400); }

document.getElementById('simulateWin').addEventListener('click', ()=>{ state.character.xp+=25; save(); renderCharacter(); });
document.getElementById('simulateLoss').addEventListener('click', ()=>{ const loss=Math.round(state.character.xp*0.3); state.character.xp=Math.max(0,state.character.xp-loss); save(); renderCharacter(); alert('Penalidade: -'+loss+' XP'); });

document.getElementById('maleBtn').addEventListener('click', ()=>{ state.character.gender='male'; save(); updateAvatar(); });
document.getElementById('femaleBtn').addEventListener('click', ()=>{ state.character.gender='female'; save(); updateAvatar(); });
document.getElementById('modeToggle').addEventListener('click', ()=>{ state.settings.mode = state.settings.mode==='dark'?'light':'dark'; document.getElementById('modeToggle').textContent = 'Modo: ' + (state.settings.mode==='dark'?'Escuro':'Claro'); save(); updateAvatar(); });
document.getElementById('musicSel').addEventListener('click', ()=>{ const order=['calm','mid','intense']; const cur=state.settings.music; const next=order[(order.indexOf(cur)+1)%order.length]; state.settings.music=next; document.getElementById('musicSel').textContent='Música: ' + (next==='calm'?'Tranquila': next==='mid'?'Intermediária':'Batalha'); save(); });

/* Audio - medieval style using WebAudio synth loops (start after click) */
let audioCtx=null, masterGain=null, musicInterval=null;
function initAudio(){ try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); masterGain = audioCtx.createGain(); masterGain.gain.value = state.settings.volume||0.6; masterGain.connect(audioCtx.destination); }catch(e){ console.warn('Audio not supported', e); } }

function playNote(freq, type, dur, vol){ if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(masterGain); o.start(); o.stop(audioCtx.currentTime + dur); }

function startMusic(kind){
  if(!audioCtx) return; stopMusic();
  if(kind==='calm'){ musicInterval = setInterval(()=>{ playNote(220,'sine',1,0.02); setTimeout(()=>playNote(330,'sine',0.8,0.015),300); setTimeout(()=>playNote(440,'sine',0.6,0.012),700); }, 1800); }
  if(kind==='mid'){ musicInterval = setInterval(()=>{ playNote(196,'triangle',0.6,0.025); setTimeout(()=>playNote(294,'triangle',0.5,0.02),200); setTimeout(()=>playNote(392,'triangle',0.4,0.018),500); }, 1400); }
  if(kind==='intense'){ musicInterval = setInterval(()=>{ playNote(164,'square',0.35,0.03); setTimeout(()=>playNote(246,'square',0.25,0.02),120); setTimeout(()=>playNote(330,'square',0.22,0.018),240); }, 900); }
}
function stopMusic(){ if(musicInterval) clearInterval(musicInterval); musicInterval=null; }
function tryStartMusic(){ startMusic(state.settings.music||'mid'); }

/* Service Worker dynamic registration */
function registerSW(){ if(!('serviceWorker' in navigator)) return; const precache=[location.href, location.pathname]; const swCode = "const CACHE_NAME='rpg-de-tarefas-final-cache-v2';const PRECACHE="+JSON.stringify(precache)+";self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(PRECACHE)).then(()=>self.skipWaiting()));});self.addEventListener('activate',e=>e.waitUntil(self.clients.claim()));self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{try{ if(e.request.method==='GET'&&res&&res.status===200){ const c=res.clone(); caches.open(CACHE_NAME).then(cache=>cache.put(e.request,c)).catch(()=>{});} }catch(er){} return res; }).catch(()=>caches.match(location.pathname))));});"; const blob=new Blob([swCode],{type:'application/javascript'}); const url=URL.createObjectURL(blob); navigator.serviceWorker.register(url).then(r=>console.log('SW registered',r)).catch(err=>console.warn(err)); }

/* Start */
document.getElementById('startBtn').addEventListener('click', ()=>{ document.getElementById('startMenu').style.display='none'; document.getElementById('gameUI').style.display='block'; initAudio(); tryStartMusic(); registerSW(); renderCharacter(); save(); });

updateAvatar(); renderCharacter();
</script>
</body>
</html>
