
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>RPG de Tarefas</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADcElEQVR42u3dMVLCQBiA0dXZggNwAG+hJSN2cACO5wEsSQczlHAI75FOW00BcYL7J9n3OgtxFpZvNgtmH57S61cKtFgsIv98ats2Gb/x1zr+xwRUSwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIC/ys5nHzb+94/GLBqR3XZd9PWf+vy3AgCXAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAL3l6PPJaz+fndj5VPv8twIAlwCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAC95ejzyWs/n53Y+VT7/LcCAJcAgAAAAgAIACAAgAAAs5M9BeP2vEnNPR/v0qSNZxUrAEAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQACA0av+fgD7U1PVeJfLeY/vcD4O+v3tqq7bJVgBgEsAQAAAewCMx+fFPfywAgAEABAA4D57ANHnk0efzw4/lX4/RM9/KwBwCQAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIANBbjj6fvPR57HBN6fdD9Py3AgCXAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAL3l6PPJS5/HDteUfj9Ez38rAHAJAAgAIACAAAACAAgAIACAAAACAAgAMEl56AMczsdBv79dbbwKYAUACAAgAMAE9gBueXtZ//q5u2ewPzX2BMAKABAAQACAGewBjF13j6K06HvC1X5PyOjxWwEAAgAIADCnPYBb/yvgc3+wAgAEABAAYB57ALc+Z3c2IFgBAAIACABQZg/gv6/Bu98D6H7u77voxm/8VgCAAAACAJTZAxj6AL7LD1YAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgCV+wb9XGeocbKTlgAAAABJRU5ErkJggg==" />
<style>
:root{--bg1:#08020f;--bg2:#2b0a44;--accent:#C084FC}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eef2ff}
body::before{
  content:"";
  position:fixed;inset:0;z-index:0;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'><defs><linearGradient id='g' x1='0' x2='0' y1='0' y2='1'><stop offset='0' stop-color='%2314083b'/><stop offset='1' stop-color='%232b0a44'/></linearGradient></defs><rect width='100%' height='100%' fill='url(%23g)'/><g fill='%23110b1f' opacity='0.9'><rect x='60' y='250' width='60' height='200'/><rect x='140' y='200' width='80' height='250'/><rect x='240' y='230' width='100' height='220'/><rect x='360' y='180' width='120' height='270'/><rect x='520' y='210' width='80' height='240'/><rect x='620' y='260' width='60' height='190'/></g><g fill='%23924cff' opacity='0.95'><path d='M110 200 L125 160 L140 200 L125 220 Z'/><path d='M220 170 L235 130 L250 170 L235 190 Z'/><path d='M410 150 L425 110 L440 150 L425 170 Z'/><path d='M580 190 L595 150 L610 190 L595 210 Z'/></g></svg>");
  background-size:cover; background-repeat:no-repeat; background-position:center;
  opacity:0.18; transform:translateZ(0);
}
.app{position:relative;max-width:900px;margin:0 auto;height:100vh;display:flex;flex-direction:column;padding:18px;gap:12px;z-index:1}
.header{display:flex;justify-content:space-between;align-items:center}
.title{font-weight:900;font-size:20px;letter-spacing:1px}
.icon-btn{width:44px;height:44px;background:rgba(255,255,255,0.03);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.menu-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.05));padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
.center-screen{flex:1;display:flex;align-items:center;justify-content:center}
.start-panel{width:100%;max-width:520px;display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center}
.btn-row{display:flex;gap:12px}
button{cursor:pointer;border-radius:10px;padding:10px 14px;border:none;font-weight:800}
.primary{background:var(--accent);color:#111}
.secondary{background:rgba(255,255,255,0.04);color:#fff}
.avatar-rect{width:220px;height:132px;border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;border:3px solid rgba(192,148,255,0.12);background:linear-gradient(180deg,rgba(76,29,149,0.45),rgba(31,6,74,0.45))}
.avatar-rect img{image-rendering:pixelated;width:128px;height:128px}
.menu-grid{display:flex;gap:12px;align-items:flex-start}
.slot{width:96px;height:96px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center}
.xp-bar{width:100%;height:18px;background:#372847;border-radius:8px;overflow:hidden}
.xp-fill{height:100%;width:0%;background:linear-gradient(90deg,#7be3ff,#c084fc);transition:width .6s}
.task{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.footer{font-size:12px;color:#ccc;text-align:center;margin-top:8px}
@media (max-width:720px){ .menu-grid{flex-direction:column} .avatar-rect{width:260px;height:150px} .start-panel{padding:8px} }
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header"><div class="title">RPG de Tarefas</div><div class="icon-btn" id="settingsBtn" title="Configurações">☰</div></div>

  <div class="center-screen">
    <div class="start-panel menu-card" id="startPanel">
      <h1 style="margin:6px 0;color:#e9d6ff">RPG de Tarefas</h1>
      <div style="max-width:420px;color:#dcd3f8">Bem-vindo aventureiro — escolha seu avatar, modo e trilha sonora antes de partir. O áudio será ativado quando você tocar em <strong>Iniciar</strong>.</div>
      <div class="btn-row" style="margin-top:6px">
        <button id="maleBtn" class="secondary">Masculino</button>
        <button id="femaleBtn" class="secondary">Feminino</button>
      </div>
      <div class="btn-row">
        <button id="modeToggle" class="secondary">Modo: Escuro</button>
        <button id="musicSel" class="secondary">Música: Intermediária</button>
      </div>
      <div style="margin-top:6px"><button id="startBtn" class="primary">Iniciar Jornada</button></div>
    </div>
  </div>

  <div id="gameUI" style="display:none">
    <div class="menu-grid">
      <div style="width:140px;display:flex;flex-direction:column;gap:8px;align-items:center">
        <div class="slot" id="slotWeapon"><img id="slotWeaponImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADiUlEQVR42u3dMU4CQRiA0cVMQcFBsDDBwthYWki0wMQDeAcb7eys7D2ECQ3GxtLGzsRCjkKHraGA3bDOvzjv1QguDF9mFtjpDdPZsgrU7/cjH75aLBaV43f8pR7/XgUUSwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAICmkv3Ztzv+p/upUdQh17fjrK//ro9/MwCwBAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAKgtRe9PXvr+7MSOp9LHvxkAWAIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgDUlqL3Jy99f3Zix1Pp498MACwBAAEABAAQAEAAAAEA/p3kKei245vqpc37+3iszj2rmAEAAgACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAHRebzSYLCP/gejron9/jbr9Cg0fWr0eQDW/cz2ANQ6P5kWNfzMAsAQABAAoimsCdp01O2YAgAAAAgC0dA4g+nPI6P3Z4bfc74fo8W8GAJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAtaXo/clz78cO6+R+P0SPfzMAsAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACoLUXvT557P3ZYJ/f7IXr8mwGAJQAgAIAAAAIACAAgAIAAAAIACAAgAMBOSm3f4ez9dau/vzq99KqAGQAgAIAAAB08B7BpzX9xMm50e8AMABAAQACAbp4DaGr1nED0NdH2Dz5DHz/6+Eu/JmT08ZsBAAIACAAgAIAAAAIACADQsuzfA9j0WwDXAwAzAEAAAAEA/kRvNJgs27zD57dpo9uv/jYgN9/Fd/wlH78ZAFgCAAIAFKX17wH4HB/MAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAEAAAAEACvMDR9RtfITxmvwAAAAASUVORK5CYII=" width="64" height="64"/></div>
        <div class="slot" id="slotArmor"><img id="slotArmorImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADiUlEQVR42u3dMU4CQRiA0cVMQcFBsDDBwthYWki0wMQDeAcb7eys7D2ECQ3GxtLGzsRCjkKHraGA3bDOvzjv1QguDF9mFtjpDdPZsgrU7/cjH75aLBaV43f8pR7/XgUUSwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAICmkv3Ztzv+p/upUdQh17fjrK//ro9/MwCwBAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAKgtRe9PXvr+7MSOp9LHvxkAWAIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgDUlqL3Jy99f3Zix1Pp498MACwBAAEABAAQAEAAAAEA/p3kKei245vqpc37+3iszj2rmAEAAgACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAHRebzSYLCP/gejron9/jbr9Cg0fWr0eQDW/cz2ANQ6P5kWNfzMAsAQABAAoimsCdp01O2YAgAAAAgC0dA4g+nPI6P3Z4bfc74fo8W8GAJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAtaXo/clz78cO6+R+P0SPfzMAsAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACoLUXvT557P3ZYJ/f7IXr8mwGAJQAgAIAAAAIACAAgAIAAAAIACAAgAMBOSm3f4ez9dau/vzq99KqAGQAgAIAAAB08B7BpzX9xMm50e8AMABAAQACAbp4DaGr1nED0NdH2Dz5DHz/6+Eu/JmT08ZsBAAIACAAgAIAAAAIACADQsuzfA9j0WwDXAwAzAEAAAAEA/kRvNJgs27zD57dpo9uv/jYgN9/Fd/wlH78ZAFgCAAIAFKX17wH4HB/MAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAEAAAAEACvMDR9RtfITxmvwAAAAASUVORK5CYII=" width="64" height="64"/></div>
        <div class="slot" id="slotCos"><img id="slotCosImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADiUlEQVR42u3dMU4CQRiA0cVMQcFBsDDBwthYWki0wMQDeAcb7eys7D2ECQ3GxtLGzsRCjkKHraGA3bDOvzjv1QguDF9mFtjpDdPZsgrU7/cjH75aLBaV43f8pR7/XgUUSwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAICmkv3Ztzv+p/upUdQh17fjrK//ro9/MwCwBAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAKgtRe9PXvr+7MSOp9LHvxkAWAIAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgDUlqL3Jy99f3Zix1Pp498MACwBAAEABAAQAEAAAAEA/p3kKei245vqpc37+3iszj2rmAEAAgACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAHRebzSYLCP/gejron9/jbr9Cg0fWr0eQDW/cz2ANQ6P5kWNfzMAsAQABAAoimsCdp01O2YAgAAAAgC0dA4g+nPI6P3Z4bfc74fo8W8GAJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAtaXo/clz78cO6+R+P0SPfzMAsAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACoLUXvT557P3ZYJ/f7IXr8mwGAJQAgAIAAAAIACAAgAIAAAAIACAAgAMBOSm3f4ez9dau/vzq99KqAGQAgAIAAAB08B7BpzX9xMm50e8AMABAAQACAbp4DaGr1nED0NdH2Dz5DHz/6+Eu/JmT08ZsBAAIACAAgAIAAAAIACADQsuzfA9j0WwDXAwAzAEAAAAEA/kRvNJgs27zD57dpo9uv/jYgN9/Fd/wlH78ZAFgCAAIAFKX17wH4HB/MAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAEAAAAEACvMDR9RtfITxmvwAAAAASUVORK5CYII=" width="64" height="64"/></div>
      </div>

      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:8px">
        <div class="avatar-rect" id="avatarRect"><img id="avatarImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADlUlEQVR42u3dPUoDQRiA4Y0sISewtPEKBoKoha2FraCFB7ASC72BhVhZi42gWNtaGJCArW0qLxFsYmssko0b99vNPE8XQn42mbzMjjHTWs02xlmgTrsT+fDZ6GuUOX7Hn+rxr2RAsgQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACYV25/9nLH/3jbN4pqZP+oW+n73/TxbwYATgEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAKy6P3J099f3Zix1Pq498MAJwCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAFJZH70+e+v7sxI6n1Me/GQA4BQAEABAAQAAAAQAEAFg6uZeg3nqH2fMi729wn+15VTEDAAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACoveR/D+Dq9K7U7T8/hv/6/HrZ+kLv77+fb7Sb84dStz+7PjYDAAQAEADAGgAhni6GfsMPMwBAAAABABayBhC9P3n0/uzwU9Wfh+jxbwYATgEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAKy6P3J696P3aYpurPQ/T4NwMApwCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACF5dH7k1e9HztMU/XnIXr8mwGAUwBAAAABAAQAEABAAAABAAQAEABAAIBGysvewdvgfeLyZq871+1fXvsTl3d3tr0rYAYACAAgAEAN1wDmXRP4fT1gBgAIACAAQDPXAJrm5PIg9PGjfxMu9d+EjD5+MwBAAAABAJZpDcDf/cEMABAAQACA5VwDmPXdf/8bAGYAgAAAAgDErAEs+rvYs+5v1vWp7c/uu/iO3wwAEABAAICKtNbaW2PngI7f8VsDAJwCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIA/Nk3cCx9ckz8h58AAAAASUVORK5CYII=" width="128" height="128"/></div>
        <div style="width:100%;max-width:520px">
          <div style="font-weight:800">Nível <span id="levelLabel">1</span> — XP: <span id="xpLabel">0</span>/<span id="xpNext">100</span></div>
          <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
        </div>
      </div>

      <div style="width:260px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:900">Tarefas</div>
          <div class="small">Agendadas: <span id="scheduledCount">0</span></div>
        </div>
        <div class="menu-card" style="margin-top:8px">
          <div style="display:flex;gap:8px;align-items:center">
            <input id="newTitle" placeholder="Nova tarefa..." style="flex:1;padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:#fff"/>
            <select id="newType"><option value="diaria">Diária</option><option value="semanal">Semanal</option><option value="mensal">Mensal</option></select>
            <select id="newImportance"><option value="1">Sem muita importância</option><option value="2">Importante</option><option value="3">Muito importante</option><option value="4">Essencial</option></select>
            <input id="newXP" placeholder="XP" style="width:70px"/>
            <button id="addTask">Adicionar</button>
          </div>
          <div id="taskList" style="margin-top:8px;display:flex;flex-direction:column;gap:8px"></div>
        </div>
      </div>
    </div>

    <div class="menu-card" style="margin-top:10px">
      <div style="font-weight:900">Batalha</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button id="simulateWin" style="background:#10b981;color:#fff">Simular vitória</button>
        <button id="simulateLoss" style="background:#ef4444;color:#fff">Simular falha</button>
      </div>
    </div>

    <div class="footer">RPG de Tarefas • Pixel Glow</div>
  </div>
</div>

<script>
const STORAGE_KEY='rpg-de-tarefas-final-castle-v1';
let state = { character:{gender:'male',level:1,xp:0,totalXP:0,equipped:{weapon:{id:'stick',name:'Graveto',rarity:1},armor:null,cos:null}}, tasks:[], scheduled:[], settings:{mode:'dark',music:'mid',volume:0.6}, monthlyRewardedFor:'' };
try{ const s=localStorage.getItem(STORAGE_KEY); if(s) state=JSON.parse(s); }catch(e){}

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function xpToNext(l){ return Math.floor(100*Math.pow(1.35,l-1)); }
function renderCharacter(){ document.getElementById('levelLabel').textContent=state.character.level; document.getElementById('xpLabel').textContent=state.character.xp; document.getElementById('xpNext').textContent=xpToNext(state.character.level); const pct=Math.max(4,Math.min(100,Math.round((state.character.xp/xpToNext(state.character.level))*100))); document.getElementById('xpFill').style.width=pct+'%'; updateAvatar(); renderTasks(); }
function updateAvatar(){ const img=document.getElementById('avatarImg'); const g=state.character.gender; const m=state.settings.mode==='light'?'light':'dark'; if(g==='male'){ img.src = (m==='dark'? 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADlUlEQVR42u3dPUoDQRiA4Y0sISewtPEKBoKoha2FraCFB7ASC72BhVhZi42gWNtaGJCArW0qLxFsYmssko0b99vNPE8XQn42mbzMjjHTWs02xlmgTrsT+fDZ6GuUOX7Hn+rxr2RAsgQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACYV25/9nLH/3jbN4pqZP+oW+n73/TxbwYATgEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAKy6P3J099f3Zix1Pq498MAJwCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIAFJZH70+e+v7sxI6n1Me/GQA4BQAEABAAQAAAAQAEAFg6uZeg3nqH2fMi729wn+15VTEDAAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABACoveR/D+Dq9K7U7T8/hv/6/HrZ+kLv77+fb7Sb84dStz+7PjYDAAQAEADAGgAhni6GfsMPMwBAAAABABayBhC9P3n0/uzwU9Wfh+jxbwYATgEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAKy6P3J696P3aYpurPQ/T4NwMApwCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACF5dH7k1e9HztMU/XnIXr8mwGAUwBAAAABAAQAEABAAAABAAQAEABAAIBGysvewdvgfeLyZq871+1fXvsTl3d3tr0rYAYACAAgAEAN1wDmXRP4fT1gBgAIACAAQDPXAJrm5PIg9PGjfxMu9d+EjD5+MwBAAAABAJZpDcDf/cEMABAAQACA5VwDmPXdf/8bAGYAgAAAAgDErAEs+rvYs+5v1vWp7c/uu/iO3wwAEABAAICKtNbaW2PngI7f8VsDAJwCAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIA/Nk3cCx9ckz8h58AAAAASUVORK5CYII=' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADj0lEQVR42u3dQUoCURzA4TGf4KJwE7Rw2RW6hXSQTtQhWnuDruEqgqIWRUKChO0EJ8ixkfef6X3fLoSp0eeP9yadN3h6+NxUgcbjceSvr1arVeX8nX+p539SAcUSABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAA4FDJ/uztzv/+bmEUdcjV9TTr69/38W8GAJYAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAjaXo/clL35+d2PFU+vg3AwBLAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAgMZS9P7kpe/PTux4Kn38mwGAJQAgAIAAAAIACAAgAMC/kzwF3Ta7uZwf83jz28XMs4oZACAAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIABA5w3eXjabyD8g+r7oF2fDbr9Ck9FR7wdQva/dD+DXp2dU1Pg3AwBLAEAAgKK4J2D3F6XW7JgBAAIACABwlGsA0f+HjN6fvarWRgFbud8P0ePfDAAsAQABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABABpL0fuT596PvW4yGhoFbOV+P0SPfzMAsAQABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABABoLEXvT557P/af1kYBW7nfD9Hj3wwALAEAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQA6K7U9wPKx3feZx5deBDADAAQAEACgD9cA2npd7P58nvmawPPHV+j5R98TrvR7QkafvxkAIACAAAB9vgZwOt1dU9U/J7DvccAMABAAQAAAAQAEABAAQACAP0ttP4u9rP1cP96hj5e2P7vP4jt/MwBAAAABAHJdA2h7gH3f39/3eP27AYAZACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgACAAgAIACAAAACAAgAIACAAAACAAgAIABAz3wDHBV2dVDxQkwAAAAASUVORK5CYII='); } else { img.src = (m==='dark'? 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADdUlEQVR42u3dMU4CQRiA0cFMDCfAWFvgASAxJlrQ2nsED2WlraWJrY0JIbGzs6Cw4grEBltDgWt2mR+Y91rjysDwZRbWnd4gjVYpUP+4H/nn0/J7mYzf+Gsd/1ECqiUAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIADAf2X7s7cb/9fHm1m0Q07Ox0Vf/32f/1YA4BQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEACgsRy9P3nt+7MTO59qn/9WAOAUABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAoLEcvT957fuzEzufap//VgDgFAAQAEAAAAEABAAQAODgZE/Bjhuml06P95luPKlYAQACAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIA7Lzq7wfwev/U6vfns8VWH9/Z8LTT42378UabPjy3+v3J3a0VACAAgAAAPgMgxPxx4R5+WAEAAgAIANDJZwDR+5NH788Ov5V+P0TPfysAcAoACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACADQWI7en7z0fuywSen3Q/T8twIApwCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACN5ej9yUvvxw6blH4/RM9/KwBwCgAIACAAgAAAAgAIACAAgAAAAgAIALCXctsDTGfvnT6gyfWVVwWsAAABAAQA2MHPAP5yeTHe+HP3AwArAEAAAAEAiugN0mjV5gBtrwOI/t6/9nsiGn/d47cCAKcAgAAAVXEdAFgBAAIACAAgAIAAAAIACABwOPK2v4df/1+B9Wv/XYtu/MZvBQAIACAAQJnPANoewH38wQoAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAKByP+Hkan+mbfVtAAAAAElFTkSuQmCC' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADjUlEQVR42u3dQUvCUADA8VmDPARDCGJ07OP0efsknTtFLNGDgpQhsa62g8429/Z8v98tCHX6/PPe1L3Jx9tXnQU0nU5D3n223W4zx+/4Uz3+qwxIlgCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAACnmqwWdR3yAcS+P3uxWxtFIzL/uRn09Y99/JsBgCUAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIABAa3no/clj35+9uDaIxuTU8ZT6+DcDAEsAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQACA1vLQ+5NHvz/77tsoGpFTx1Pq498MACwBAAEABAAQAEAAAAEALk7uKRi5snju9faq9ZMnFTMAQABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIDRS/56AEVVjfsBlkW/t7f8vOjX8z7rdnzrsjQDAAQAEADAOQDCeKlcww8zAEAAAAEAejkHEHp/8tD7s8O+od8Poce/GQBYAgACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACALSWh96ffOj92JsKY4A9Q78fQo9/MwCwBAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAGgtD70/+dD7scMhQ78fQo9/MwCwBAAEABAAQAAAAQAEALg4+bnvYPN++HPOTePvu0cvCpgBAAIACAAQwzmAY2v+24e/37X2WwAwAwAEABAAII5zAMfW/Mf+3/cAwAwAEABAAIA4zgE0P9eP7XsA89ks6P2HPv7UrwkZ+vjNAAABAAQAEABAAAABAAQAEABAAAABAAQA+IfJalHXXW5g+drvA2r+VuDcfBff8ad8/GYAYAkACACQlM7XA+h6Db/Uf48NZgCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAIAAAAIACAAgAIAAAAIACAAgAIAAANH7BRu8dxbk+mXoAAAAAElFTkSuQmCC'); } }

document.getElementById('addTask').addEventListener('click', ()=>{ const title=document.getElementById('newTitle').value.trim(); if(!title) return alert('Nome da tarefa?'); const type=document.getElementById('newType').value; const imp=Number(document.getElementById('newImportance').value); const xp=Number(document.getElementById('newXP').value)||20; const obj={id:'t-'+Math.random().toString(36).slice(2,9),title,type,importance:imp,xp,created:Date.now(),due:(type==='diaria'?Date.now()+24*3600*1000: type==='semanal'?Date.now()+7*24*3600*1000:Date.now()+30*24*3600*1000),done:false}; state.tasks.unshift(obj); save(); renderCharacter(); document.getElementById('newTitle').value=''; });

function renderTasks(){ const list=document.getElementById('taskList'); list.innerHTML=''; state.tasks.forEach(t=>{ const el=document.createElement('div'); el.className='task'; el.innerHTML=`<div><div style="font-weight:800">${t.title}</div><div style="font-size:12px;color:#ccc">${t.type} • ${t.xp} XP • ${['','Sem muita importância','Importante','Muito importante','Essencial'][t.importance]}</div></div>`; const right=document.createElement('div'); const btn=document.createElement('button'); btn.textContent='Concluir'; btn.onclick=()=>completeTask(t.id); const del=document.createElement('button'); del.textContent='Excluir'; del.onclick=()=>{ state.tasks=state.tasks.filter(x=>x.id!==t.id); save(); renderCharacter(); }; right.appendChild(btn); right.appendChild(del); el.appendChild(right); list.appendChild(el); }); }

function completeTask(id){ const task=state.tasks.find(t=>t.id===id); if(!task) return; const bonus = 1 + (0.025*(task.importance-1)); const gained = Math.round(task.xp * bonus); state.character.xp += gained; state.character.totalXP += gained; while(state.character.xp >= xpToNext(state.character.level)){ state.character.xp -= xpToNext(state.character.level); state.character.level++; } task.done=true; task.completedAt=Date.now(); save(); renderCharacter(); const chest=document.createElement('div'); chest.style.position='fixed'; chest.style.left='50%'; chest.style.top='50%'; chest.style.transform='translate(-50%,-50%)'; chest.style.width='160px'; chest.style.height='100px'; chest.style.background='linear-gradient(180deg,#c08aff,#ffd166)'; chest.style.display='flex'; chest.style.alignItems='center'; chest.style.justifyContent='center'; chest.style.borderRadius='10px'; chest.style.zIndex=9999; chest.textContent='BAÚ'; document.body.appendChild(chest); setTimeout(()=>{ chest.remove(); },1400); }

document.getElementById('simulateWin').addEventListener('click', ()=>{ state.character.xp+=25; save(); renderCharacter(); });
document.getElementById('simulateLoss').addEventListener('click', ()=>{ const loss=Math.round(state.character.xp*0.3); state.character.xp=Math.max(0,state.character.xp-loss); save(); renderCharacter(); alert('Penalidade: -'+loss+' XP'); });

document.getElementById('maleBtn').addEventListener('click', ()=>{ state.character.gender='male'; save(); updateAvatar(); });
document.getElementById('femaleBtn').addEventListener('click', ()=>{ state.character.gender='female'; save(); updateAvatar(); });
document.getElementById('modeToggle').addEventListener('click', ()=>{ state.settings.mode = state.settings.mode==='dark'?'light':'dark'; document.getElementById('modeToggle').textContent = 'Modo: ' + (state.settings.mode==='dark'?'Escuro':'Claro'); save(); updateAvatar(); });
document.getElementById('musicSel').addEventListener('click', ()=>{ const order=['calm','mid','intense']; const cur=state.settings.music; const next=order[(order.indexOf(cur)+1)%order.length]; state.settings.music=next; document.getElementById('musicSel').textContent='Música: ' + (next==='calm'?'Tranquila': next==='mid'?'Intermediária':'Batalha'); save(); });

let audioCtx=null, masterGain=null, musicInterval=null;
function initAudio(){ try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); masterGain = audioCtx.createGain(); masterGain.gain.value = state.settings.volume||0.6; masterGain.connect(audioCtx.destination); }catch(e){ console.warn('Audio not supported', e); } }

function playNote(freq, type, dur, vol){ if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(masterGain); o.start(); o.stop(audioCtx.currentTime + dur); }

function startMusic(kind){
  if(!audioCtx) return; stopMusic();
  if(kind==='calm'){ musicInterval = setInterval(()=>{ playNote(220,'sine',1,0.02); setTimeout(()=>playNote(330,'sine',0.8,0.015),300); setTimeout(()=>playNote(440,'sine',0.6,0.012),700); }, 1800); }
  if(kind==='mid'){ musicInterval = setInterval(()=>{ playNote(196,'triangle',0.6,0.025); setTimeout(()=>playNote(294,'triangle',0.5,0.02),200); setTimeout(()=>playNote(392,'triangle',0.4,0.018),500); }, 1400); }
  if(kind==='intense'){ musicInterval = setInterval(()=>{ playNote(164,'square',0.35,0.03); setTimeout(()=>playNote(246,'square',0.25,0.02),120); setTimeout(()=>playNote(330,'square',0.22,0.018),240); }, 900); }
}
function stopMusic(){ if(musicInterval) clearInterval(musicInterval); musicInterval=null; }
function tryStartMusic(){ startMusic(state.settings.music||'mid'); }

function registerSW(){ if(!('serviceWorker' in navigator)) return; const precache=[location.href, location.pathname]; const swCode = "const CACHE_NAME='rpg-de-tarefas-castle-cache-v1';const PRECACHE="+JSON.stringify(precache)+";self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(PRECACHE)).then(()=>self.skipWaiting()));});self.addEventListener('activate',e=>e.waitUntil(self.clients.claim()));self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{try{ if(e.request.method==='GET'&&res&&res.status===200){ const c=res.clone(); caches.open(CACHE_NAME).then(cache=>cache.put(e.request,c)).catch(()=>{});} }catch(er){} return res; }).catch(()=>caches.match(location.pathname))));});"; const blob=new Blob([swCode],{type:'application/javascript'}); const url=URL.createObjectURL(blob); navigator.serviceWorker.register(url).then(r=>console.log('SW registered',r)).catch(err=>console.warn(err)); }

document.getElementById('startBtn').addEventListener('click', ()=>{ document.getElementById('startPanel').style.display='none'; document.getElementById('gameUI').style.display='block'; initAudio(); tryStartMusic(); registerSW(); renderCharacter(); save(); });

updateAvatar(); renderCharacter();
</script>
</body>
</html>
